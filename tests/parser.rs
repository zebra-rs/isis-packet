use bytes::BytesMut;
use hex_literal::hex;
use isis_packet::*;

fn parse_emit(buf: &[u8]) {
    let packet = parse(buf);
    assert!(packet.is_ok());

    let (_, packet) = packet.unwrap();
    let mut buf = BytesMut::new();
    packet.emit(&mut buf);

    let packet = parse(&buf);
    assert!(packet.is_ok());

    let (_, packet) = packet.unwrap();
    println!("{}", packet);
}

#[test]
pub fn parse_l1lsp_test_1() {
    const PACKET: &[u8] = &hex!(
        "
        01 80 C2 00 00 14 00 1C 42 E5 C4 21 00 CE FE
        FE 03 83 1B 01 00 12 01 00 00 00 CB 04 8F 00
        00 00 00 00 01 00 00 00 00 00 9A 0F 44 01 81
        01 CC 01 04 03 49 00 00 89 07 75 62 75 6E 74
        75 31 F2 22 AC 13 00 01 00 02 09 C0 00 1F 40
        01 03 00 3E 80 13 01 00 16 09 00 00 03 E8 01
        03 00 3A 98 17 02 01 08 86 04 01 01 01 01 16
        48 00 00 00 00 00 01 03 00 00 0A 19 06 04 0B
        00 00 01 08 04 0B 00 00 02 20 0B 30 00 00 00
        00 00 00 02 00 3A 98 00 00 00 00 00 01 04 00
        00 0A 19 06 04 0A 00 00 01 08 04 0A 00 00 03
        20 0B 30 00 00 00 00 00 00 03 00 3A 99 84 04
        AC 13 00 01 87 22 00 00 00 0A 60 01 01 01 01
        08 03 06 00 00 00 00 00 64 00 00 00 0A 18 0B
        00 00 00 00 00 0A 18 0A 00 00
        "
    );
    parse_emit(&PACKET[17..]);
}

#[test]
pub fn parse_l1lsp_test2() {
    const PACKET: &[u8] = &hex!(
        "
        01 80 c2 00 00 14 00 1c 42 e8 0c 23 00 9e fe fe
        03 83 1b 01 00 12 01 00 00 00 9b 02 2b 00 00 00
        00 00 02 00 00 00 00 00 04 c9 f3 01 81 01 cc 01
        04 03 49 00 00 89 07 75 62 75 6e 74 75 32 f2 22
        0a 0a 00 01 00 02 09 c0 00 1f 40 01 03 00 3e 80
        13 01 00 16 09 00 00 03 e8 01 03 00 3a 98 17 02
        01 08 86 04 02 02 02 02 16 18 00 00 00 00 00 01
        04 00 00 0a 0d 20 0b 30 00 00 00 00 00 00 01 00
        3a 98 84 04 0a 0a 00 01 87 22 00 00 00 0a 60 02
        02 02 02 08 03 06 00 00 00 00 00 c8 00 00 00 0a
        18 0a 00 00 00 00 00 0a 18 0a 0a 00
        "
    );
    parse_emit(&PACKET[17..]);
}

#[test]
pub fn parse_l1lsp_multi_is_reach() {
    const PACKET: &[u8] = &hex!(
        "
        01 80 c2 00 00 14 00 1c 42 e8 0c 23 00 36 fe fe
        03 83 1b 01 00 12 01 00 00 00 33 04 a0 00 00 00
        00 00 01 03 00 00 00 00 01 95 34 01 16 16 00 00
        00 00 00 01 00 00 00 00 00 00 00 00 00 00 03 00
        00 00 00 00
        "
    );
    parse_emit(&PACKET[17..]);
}

#[test]
pub fn parse_l1lsp_ipv6_reach() {
    const PACKET: &[u8] = &hex!(
        "
        01 80 c2 00 00 14 00 1c 42 e8 0c 23 00 b5 fe fe
        03 83 1b 01 00 12 01 00 00 00 b2 04 7f 00 00 00
        00 00 01 00 00 00 00 00 32 2d 9d 01 81 02 cc 8e
        01 04 03 49 00 00 89 07 75 62 75 6e 74 75 31 f2
        22 0b 00 00 01 00 02 09 c0 00 1f 40 01 03 00 3e
        80 13 01 00 16 09 00 00 03 e8 01 03 00 3a 98 17
        02 01 08 86 04 01 01 01 01 16 1e 00 00 00 00 00
        01 04 00 00 0a 13 08 04 0a 00 00 02 20 0b 30 00
        00 00 00 00 00 02 00 3a 98 84 04 0b 00 00 01 87
        22 00 00 00 0a 60 01 01 01 01 08 03 06 00 00 00
        00 00 64 00 00 00 0a 18 0b 00 00 00 00 00 0a 18
        0a 00 00 ec 0e 00 00 00 0a 00 40 30 01 20 03 00
        00 00 00
     "
    );
    parse_emit(&PACKET[17..]);
}

#[test]
pub fn parse_l1hello_test() {
    const PACKET: &[u8] = &hex!(
        "
        01 80 c2 00 00 14 00 00 00 00 00 00 05 dc fe fe
        03 83 1b 01 00 0f 01 00 00 01 00 00 00 00 00 03
        00 1e 05 d9 00 00 00 00 00 00 01 03 01 04 03 49
        00 00 06 06 00 1c 42 e8 0c 23 81 01 cc 84 04 0b
        00 00 02 08 ff 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 08 ff 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 08 ff 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 08 ff 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 08 ff 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 08 a0 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
        00 00 00 00 00 00 00 00 00 00
        "
    );
    parse_emit(&PACKET[17..]);
}

#[test]
pub fn parse_csnp() {
    const PACKET: &[u8] = &hex!(
        "
        01 80 c2 00 00 14 00 1c 42 e8 0c 23 00 86 fe fe
        03 83 21 01 00 18 01 00 00 00 83 00 00 00 00 00
        01 00 00 00 00 00 00 00 00 00 ff ff ff ff ff ff
        ff ff 09 60 04 81 00 00 00 00 00 01 00 00 00 00
        00 32 2d 9d 04 97 00 00 00 00 00 01 03 00 00 00
        00 01 95 34 04 62 00 00 00 00 00 01 04 00 00 00
        00 22 38 70 04 8e 00 00 00 00 00 02 00 00 00 00
        00 29 b5 9d 04 9e 00 00 00 00 00 03 00 00 00 00
        00 01 45 70 04 a9 00 00 00 00 00 03 00 01 00 00
        00 02 1d 26
        "
    );
    parse_emit(&PACKET[17..]);
}

#[test]
pub fn parse_psnp() {
    const PACKET: &[u8] = &hex!(
        "
        01 80 c2 00 00 14 00 00 00 00 00 00 00 46 fe fe
        03 83 11 01 00 1a 01 00 00 00 43 00 00 00 00 00
        03 00 09 30 04 8e 00 00 00 00 00 02 00 00 00 00
        00 00 b5 9d 04 62 00 00 00 00 00 01 04 00 00 00
        00 00 38 70 04 81 00 00 00 00 00 01 00 00 00 00
        00 00 2d 9d
        "
    );
    parse_emit(&PACKET[17..]);
}
